<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‹ã‚“ãŸã‚“ãƒ™ã‚¤ã‚ºæ¨å®šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
  <!-- Bulma CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background-color: #f5f7fa;
      font-family: 'Helvetica Neue', Arial, sans-serif;
    }

    .card {
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .slider-output {
      font-weight: bold;
      color: #3273dc;
    }

    .result-box {
      background-color: #effaf5;
      border-left: 5px solid #257942;
      padding: 1.5rem;
      margin-top: 1rem;
    }

    .chart-container {
      position: relative;
      height: 300px;
      width: 100%;
    }
  </style>
</head>

<body>

  <div id="app">
    <!-- Header -->
    <section class="hero is-info is-small">
      <div class="hero-body">
        <div class="container">
          <p class="title">
            ğŸ“Š ã‹ã‚“ãŸã‚“ãƒ™ã‚¤ã‚ºæ¨å®š
          </p>
          <p class="subtitle">
            ã€Œéå»ã®çµŒé¨“ã€ã¨ã€Œæ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã€ã‚’çµ„ã¿åˆã‚ã›ã¦ã€çœŸã®å®ŸåŠ›ã‚’äºˆæ¸¬ã—ã¾ã™
          </p>
        </div>
      </div>
    </section>

    <div class="container mt-5 mb-5 pl-3 pr-3">
      <div class="columns">

        <!-- Left Column: Inputs -->
        <div class="column is-5">

          <!-- Step 1: Prior Knowledge -->
          <div class="card mb-4">
            <header class="card-header">
              <p class="card-header-title">
                â‘  äº‹å‰ã®äºˆæƒ³ï¼ˆéå»ã®çµŒé¨“å‰‡ï¼‰
              </p>
            </header>
            <div class="card-content">
              <div class="content">
                <p class="is-size-7 mb-3">
                  ãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã‚‹å‰ã€å¯¾è±¡ã®ã€ŒæˆåŠŸç‡ï¼ˆã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç‡ãªã©ï¼‰ã€ã¯ã©ã®ãã‚‰ã„ã ã¨äºˆæƒ³ã—ã¦ã„ã¾ã—ãŸã‹ï¼Ÿ
                </p>

                <div class="field">
                  <label class="label">ã‚·ãƒŠãƒªã‚ªé¸æŠï¼ˆãƒ—ãƒªã‚»ãƒƒãƒˆï¼‰</label>
                  <div class="control">
                    <div class="select is-fullwidth">
                      <select v-model="selectedPreset" @change="applyPreset">
                        <option value="flat">å…¨ãè¦‹å½“ãŒã¤ã‹ãªã„ï¼ˆãƒ•ãƒ©ãƒƒãƒˆï¼‰</option>
                        <option value="low">ä½ã‚ã ã¨æ€ã†ï¼ˆWebåºƒå‘Šãªã© 5%ä»˜è¿‘ï¼‰</option>
                        <option value="high">é«˜ã‚ã ã¨æ€ã†ï¼ˆãƒªãƒ”ãƒ¼ãƒˆç‡ãªã© 70%ä»˜è¿‘ï¼‰</option>
                        <option value="custom">è‡ªåˆ†ã§è©³ã—ãè¨­å®šã™ã‚‹</option>
                      </select>
                    </div>
                  </div>
                </div>

                <div v-if="selectedPreset === 'custom'" class="notification is-light mt-3">
                  <div class="field">
                    <label class="label">ä»®æƒ³çš„ãªæˆåŠŸæ•° (Î±)</label>
                    <input class="input" type="number" v-model.number="priorAlpha" min="1">
                  </div>
                  <div class="field">
                    <label class="label">ä»®æƒ³çš„ãªå¤±æ•—æ•° (Î²)</label>
                    <input class="input" type="number" v-model.number="priorBeta" min="1">
                  </div>
                </div>

                <p class="is-size-7 has-text-grey mt-2">
                  ç¾åœ¨ã®è¨­å®š: ã€Œéå»ã« {{ priorAlpha + priorBeta }} å›ä¸­ã€{{ priorAlpha }} å›æˆåŠŸã—ãŸã€ç¨‹åº¦ã®äº‹å‰çŸ¥è­˜ã‚’æŒã£ã¦ã„ã¾ã™ã€‚
                </p>
              </div>
            </div>
          </div>

          <!-- Step 2: New Data -->
          <div class="card">
            <header class="card-header">
              <p class="card-header-title">
                â‘¡ æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿé¨“çµæœï¼‰
              </p>
            </header>
            <div class="card-content">
              <div class="content">
                <p class="is-size-7 mb-3">
                  ä»Šå›å®Ÿæ–½ã—ãŸãƒ†ã‚¹ãƒˆã‚„ã€å¾—ã‚‰ã‚ŒãŸå®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
                </p>

                <div class="field">
                  <label class="label">è©¦è¡Œå›æ•° (N)</label>
                  <div class="control">
                    <input class="input" type="number" v-model.number="trials" min="0" placeholder="ä¾‹: 100">
                  </div>
                </div>

                <div class="field">
                  <label class="label">æˆåŠŸå›æ•° (Success)</label>
                  <div class="control">
                    <input class="input" type="number" v-model.number="successes" min="0" :max="trials"
                      placeholder="ä¾‹: 5">
                  </div>
                  <p v-if="successes > trials" class="help is-danger">æˆåŠŸå›æ•°ã¯è©¦è¡Œå›æ•°ä»¥ä¸‹ã«ã—ã¦ãã ã•ã„</p>
                </div>

                <p class="mt-2">
                  ä»Šå›ã®çµæœå˜ä½“ã®æˆåŠŸç‡: <span class="tag is-info is-light">{{ currentRate }}%</span>
                </p>
              </div>
            </div>
          </div>

        </div>

        <!-- Right Column: Visualization & Result -->
        <div class="column is-7">
          <div class="card">
            <header class="card-header">
              <p class="card-header-title">
                â‘¢ åˆ†æçµæœï¼ˆæ›´æ–°ã•ã‚ŒãŸäºˆæ¸¬ï¼‰
              </p>
            </header>
            <div class="card-content">

              <!-- Chart -->
              <div class="chart-container">
                <canvas id="bayesChart"></canvas>
              </div>

              <!-- Numerical Results -->
              <div class="result-box">
                <h4 class="title is-5 mb-2">çµè«–ï¼šçœŸã®æˆåŠŸç‡ã¯...</h4>
                <div class="columns is-mobile">
                  <div class="column">
                    <p class="heading">æœ€ã‚‚ã‚ã‚Šãˆã‚‹ç¢ºç‡</p>
                    <p class="title is-4">{{ posteriorMean }}%</p>
                  </div>
                  <div class="column">
                    <p class="heading">95%ã®ç¢ºç‡ã§ã“ã®ç¯„å›²</p>
                    <p class="title is-4 is-size-5-mobile">{{ credibleInterval }}</p>
                  </div>
                </div>
                <p class="is-size-7 mt-2">
                  è§£èª¬: äº‹å‰ã®äºˆæƒ³ï¼ˆç‚¹ç·šï¼‰ã«å¯¾ã—ã¦ã€æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ãŒåŠ ã‚ã‚Šã€ã‚ãªãŸã®çŸ¥è­˜ã¯<strong class="has-text-success">ç·‘è‰²ã®å±±</strong>ã®ã‚ˆã†ã«æ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚
                  å±±ãŒé‹­ã„ã»ã©ã€äºˆæ¸¬ã®ã€Œç¢ºä¿¡åº¦ã€ãŒé«˜ã„ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚
                </p>
              </div>

            </div>
          </div>

          <article class="message is-warning mt-4 is-small">
            <div class="message-body">
              <strong>ãƒ“ã‚¸ãƒã‚¹ã¸ã®å¿œç”¨ãƒ’ãƒ³ãƒˆ:</strong><br>
              ãƒ‡ãƒ¼ã‚¿ãŒå°‘ãªã„æ™‚ï¼ˆè©¦è¡Œå›æ•°ãŒå°‘ãªã„æ™‚ï¼‰ã€çµæœã¯ã€Œäº‹å‰ã®äºˆæƒ³ã€ã«å¼•ã£å¼µã‚‰ã‚Œã¾ã™ã€‚<br>
              é€†ã«ãƒ‡ãƒ¼ã‚¿ãŒååˆ†ã«é›†ã¾ã‚Œã°ã€ã€Œäº‹å‰ã®äºˆæƒ³ã€ã®å½±éŸ¿ã¯æ¶ˆãˆã€ãƒ‡ãƒ¼ã‚¿ãã®ã‚‚ã®ã®å€¤ã«è¿‘ã¥ãã¾ã™ã€‚<br>
              ã€ŒãŸã¾ãŸã¾æ•°å›æˆåŠŸã—ãŸã ã‘ã€ãªã®ã‹ã€ã€Œå®ŸåŠ›ãŒã‚ã‚‹ã€ã®ã‹ã‚’è¦‹æ¥µã‚ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚
            </div>
          </article>

        </div>
      </div>
    </div>

    <footer class="footer pt-5 pb-5">
      <div class="content has-text-centered is-size-7">
        <p>
          Powered by Vue.js 3 & Chart.js. Calculation based on Beta-Binomial conjugate prior.
        </p>
      </div>
    </footer>
  </div>

  <script>
    const { createApp, ref, computed, watch, onMounted } = Vue;

    createApp({
      setup() {
        // --- State ---
        // Prior (Beta distribution parameters)
        const priorAlpha = ref(1); // Successes belief
        const priorBeta = ref(1);  // Failures belief
        const selectedPreset = ref('flat');

        // Likelihood (New Data)
        const trials = ref(100);
        const successes = ref(10);

        // Chart instance
        let myChart = null;

        // --- Logic ---

        // Presets Handler
        const applyPreset = () => {
          switch (selectedPreset.value) {
            case 'flat': // Uniform distribution
              priorAlpha.value = 1;
              priorBeta.value = 1;
              break;
            case 'low': // Expecting around 5% (Strong belief: like 2 successes in 40)
              priorAlpha.value = 2;
              priorBeta.value = 38;
              break;
            case 'high': // Expecting around 70%
              priorAlpha.value = 14;
              priorBeta.value = 6;
              break;
            case 'custom':
              // Do not change values, let user edit
              break;
          }
        };

        // Calculated Properties
        const currentRate = computed(() => {
          if (trials.value === 0) return 0;
          return ((successes.value / trials.value) * 100).toFixed(1);
        });

        // Posterior Parameters (Beta post)
        // Posterior Alpha = Prior Alpha + Successes
        // Posterior Beta = Prior Beta + (Trials - Successes)
        const postAlpha = computed(() => priorAlpha.value + successes.value);
        const postBeta = computed(() => priorBeta.value + (trials.value - successes.value));

        // Summary Statistics
        const posteriorMean = computed(() => {
          const mean = postAlpha.value / (postAlpha.value + postBeta.value);
          return (mean * 100).toFixed(1);
        });

        // Simple 95% Credible Interval Approximation (using Normal approx of Beta for simplicity in JS)
        // Note: For very small alpha/beta this is less accurate, but sufficient for business intuition visualization.
        const credibleInterval = computed(() => {
          const a = postAlpha.value;
          const b = postBeta.value;
          const mean = a / (a + b);
          const variance = (a * b) / (Math.pow(a + b, 2) * (a + b + 1));
          const stdDev = Math.sqrt(variance);

          // 95% is roughly +/- 1.96 SD
          let low = mean - 1.96 * stdDev;
          let high = mean + 1.96 * stdDev;

          // Clamp to [0, 1]
          low = Math.max(0, low);
          high = Math.min(1, high);

          return `${(low * 100).toFixed(1)}% ã€œ ${(high * 100).toFixed(1)}%`;
        });

        // --- Math Helpers for Chart ---

        // Log Gamma Function (Lanczos approximation)
        function logGamma(z) {
          var c = [76.18009172947146, -86.50532032941677, 24.01409824083091, -1.231739572450155, 0.1208650973866179e-2, -0.5395239384953e-5];
          var x = z;
          var y = z;
          var tmp = x + 5.5;
          tmp -= (x + 0.5) * Math.log(tmp);
          var ser = 1.000000000190015;
          for (var j = 0; j < 6; j++) ser += c[j] / ++y;
          return -tmp + Math.log(2.5066282746310005 * ser / x);
        }

        // Beta PDF
        function betaPDF(x, alpha, beta) {
          if (x <= 0 || x >= 1) return 0;
          // B(alpha, beta) = Gamma(alpha)*Gamma(beta) / Gamma(alpha+beta)
          // log(PDF) = (alpha-1)ln(x) + (beta-1)ln(1-x) - logGamma(alpha) - logGamma(beta) + logGamma(alpha+beta)
          const logVal = (alpha - 1) * Math.log(x) + (beta - 1) * Math.log(1 - x)
            - logGamma(alpha) - logGamma(beta) + logGamma(alpha + beta);
          return Math.exp(logVal);
        }

        // Generate Data Points for Chart
        const generateChartData = () => {
          const labels = [];
          const priorData = [];
          const posteriorData = [];

          // Create 100 points from 0.01 to 0.99
          for (let i = 0; i <= 100; i++) {
            const x = i / 100;
            // Avoid 0 and 1 singularities for certain alpha/beta < 1
            const safeX = x === 0 ? 0.001 : (x === 1 ? 0.999 : x);

            labels.push(i + '%');
            priorData.push(betaPDF(safeX, priorAlpha.value, priorBeta.value));
            posteriorData.push(betaPDF(safeX, postAlpha.value, postBeta.value));
          }
          return { labels, priorData, posteriorData };
        };

        // --- Chart Handling ---
        const updateChart = () => {
          if (!myChart) return;

          const { labels, priorData, posteriorData } = generateChartData();
          myChart.data.labels = labels;
          myChart.data.datasets[0].data = priorData;
          myChart.data.datasets[1].data = posteriorData;
          myChart.update();
        };

        onMounted(() => {
          const ctx = document.getElementById('bayesChart').getContext('2d');
          const { labels, priorData, posteriorData } = generateChartData();

          myChart = new Chart(ctx, {
            type: 'line',
            data: {
              labels: labels,
              datasets: [
                {
                  label: 'äº‹å‰ã®äºˆæƒ³ (Prior)',
                  data: priorData,
                  borderColor: '#b5b5b5',
                  backgroundColor: 'rgba(181, 181, 181, 0.2)',
                  borderDash: [5, 5],
                  borderWidth: 2,
                  pointRadius: 0,
                  fill: true,
                  tension: 0.4
                },
                {
                  label: 'æ›´æ–°å¾Œã®çµæœ (Posterior)',
                  data: posteriorData,
                  borderColor: '#48c774', // Bulma success color
                  backgroundColor: 'rgba(72, 199, 116, 0.4)',
                  borderWidth: 3,
                  pointRadius: 0,
                  fill: true,
                  tension: 0.4
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              interaction: {
                mode: 'index',
                intersect: false,
              },
              scales: {
                x: {
                  title: { display: true, text: 'æˆåŠŸç‡ (Probability)' },
                  ticks: { maxTicksLimit: 11 }
                },
                y: {
                  display: false, // Hide Probability Density Value as it's confusing for amateurs
                  title: { display: true, text: 'ç¢ºã‹ã‚‰ã—ã• (Density)' }
                }
              },
              plugins: {
                tooltip: {
                  callbacks: {
                    title: (context) => `æˆåŠŸç‡: ${context[0].label}`,
                    label: (context) => {
                      return `${context.dataset.label}: ã‚¹ã‚³ã‚¢ ${context.raw.toFixed(2)}`;
                    }
                  }
                }
              }
            }
          });
        });

        // Watch for changes
        watch([priorAlpha, priorBeta, trials, successes], () => {
          // Validation for successes <= trials
          if (successes.value > trials.value) return;
          updateChart();
        });

        return {
          priorAlpha,
          priorBeta,
          selectedPreset,
          trials,
          successes,
          applyPreset,
          currentRate,
          posteriorMean,
          credibleInterval,
          postAlpha,
          postBeta
        };
      }
    }).mount('#app');
  </script>

</body>

</html>